<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>(ì£¼)ë©”íŠ¸ë¡œ R & S AI ì•± - Ver 16.0 Full Expansion</title>
    <style>
        /* ==================================================
           [1] ì „ì—­ ë””ìì¸ ì‹œìŠ¤í…œ ë° ì‹œì¸ì„± ìµœì í™” (í”„ë¦¬ë¯¸ì—„ ë ˆë²¨)
           - ìƒë‹¨ í—¤ë”: ì„¸ë¡œ ë†’ì´ 25% ì¶•ì†Œ / ì¤‘ì•™ ì •ë ¬
           - ì…ë ¥ í•„ë“œ: ì„¸ë¡œ ë†’ì´ 25% ì¶•ì†Œ / ìŠ¬ë¦¼ ê·¸ë¦¬ë“œ
           - ë²„íŠ¼: ì„¸ë¡œ ë†’ì´ 25% ì¶•ì†Œ / 3D ê´‘íƒ ê·¸ë¼ë°ì´ì…˜
           ==================================================
        */
        :root {
            --metro-blue: #007aff;
            --metro-green: #34c759;
            --metro-dark: #1c1c1e;
            --metro-light: #f2f2f7;
            --metro-white: #ffffff;
            --metro-border: #d1d1d6;
            
            /* ë²„íŠ¼ 3D ì…ì²´ ë ˆì´ì–´ íŒŒë¼ë¯¸í„° - ë¬´ì••ì¶• ìƒì„¸ ì •ì˜ */
            --blue-grad-start: #007aff;
            --blue-grad-end: #0056b3;
            --green-grad-start: #34c759;
            --green-grad-end: #28a745;
            
            /* ì…ì²´ê° ê¹Šì´ ì„¤ì • */
            --shadow-3d-premium: 0 12px 24px rgba(0,0,0,0.18), 0 4px 8px rgba(0,0,0,0.1);
            --inner-light: inset 2px 2px 5px rgba(255,255,255,0.4);
            --inner-shadow: inset -2px -2px 5px rgba(0,0,0,0.2);
            
            /* í•˜ë‹¨ ì•ˆì „ ì˜ì—­ ìµœì í™” */
            --safe-area-bottom: env(safe-area-inset-bottom);
        }

        /* ê¸°ë³¸ ë ˆì´ì•„ì›ƒ ë¬´ê²°ì„± í™•ë³´ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-font-smoothing: antialiased;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Apple SD Gothic Neo", "Malgun Gothic", sans-serif;
            background-color: var(--metro-light);
            display: flex;
            justify-content: center;
            min-height: 100vh;
            color: var(--metro-dark);
            overflow-x: hidden;
        }

        .app-container {
            width: 100%;
            max-width: 500px;
            background-color: var(--metro-white);
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 100px rgba(0,0,0,0.35);
            position: relative;
        }

        /* ==================================================
           [2] í—¤ë” ëª¨ë“ˆ (ì¤‘ì•™ ì •ë ¬ ë° ë²„ì „ ê³ ì •)
           - ê¸°ì¡´ ëŒ€ë¹„ ì„¸ë¡œ í¬ê¸° 25% ì¶•ì†Œ ì™„ë£Œ
           ==================================================
        */
        header {
            background-color: var(--metro-dark);
            color: white;
            padding: 12px 15px 8px; /* ì„¸ë¡œ ë†’ì´ ì •ë°€ ì¶•ì†Œ */
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 4px solid var(--metro-blue);
            text-align: center; /* ì œëª© ì¤‘ì•™ ë°°ì¹˜ */
        }

        header h1 {
            font-size: 1.15rem;
            font-weight: 900;
            letter-spacing: -0.8px;
            margin: 0 auto;
        }

        .header-sub-layout {
            display: flex;
            justify-content: flex-end;
            width: 100%;
            margin-top: 6px;
        }

        .ver-status-text {
            font-size: 0.75rem;
            color: #aeaeb2;
            font-weight: 800;
            font-family: 'Courier New', Courier, monospace;
        }

        /* ==================================================
           [3] ë©”ì¸ ì½˜í…ì¸  ìŠ¤í¬ë¡¤ ì˜ì—­
           - ì‹œì¸ì„±ì„ ìœ„í•œ ì—¬ë°± ë° ë°°ì¹˜ ì •ë°€í™”
           ==================================================
        */
        .content-scroll-area {
            padding: 12px 10px;
            flex: 1;
        }

        .section-label {
            font-size: 0.95rem;
            font-weight: 950;
            color: #3a3a3c;
            margin: 18px 0 10px 4px;
            border-left: 6px solid var(--metro-blue);
            padding-left: 15px;
            display: flex;
            align-items: center;
        }

        /* 4:3 ê³ ì • ì‚¬ì§„ ì¹´ë“œ ë””ìì¸ */
        .photo-card-box {
            width: 100%;
            aspect-ratio: 4 / 3;
            background-color: #f8f8fa;
            border: 2.5px dashed var(--metro-border);
            border-radius: 20px;
            margin-bottom: 25px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }

        .photo-card-box.ai-active { 
            border: 3.5px dashed var(--metro-blue); 
            background-color: #f0f7ff; 
        }

        .photo-card-box.board-active { 
            border: 3.5px solid var(--metro-green); 
            background-color: #fafff0; 
        }

        .photo-card-box:active { 
            transform: scale(0.95); 
            background-color: #e5e5ea; 
        }

        .icon-svg-wrapper { width: 55px; margin-bottom: 12px; opacity: 0.9; }
        .card-main-title { font-size: 1.15rem; font-weight: 900; color: var(--metro-blue); }
        .card-sub-info { font-size: 0.85rem; color: #8e8e93; margin-top: 8px; font-weight: 700; }

        .viewer-layer {
            width: 100%;
            height: 100%;
            object-fit: contain;
            position: absolute;
            background: #000;
            display: none;
            z-index: 100;
        }

        /* ==================================================
           [4] ì…ë ¥ í•„ë“œ ê·¸ë¦¬ë“œ ì‹œìŠ¤í…œ (ë³‘í•© ë° ì¶•ì†Œ)
           - ë™/í˜¸ ë³‘í•© / ì ‘ìˆ˜ì¼ í•œì¤„ / ì„¸ë¡œ ë†’ì´ 25% ì¶•ì†Œ
           ==================================================
        */
        .input-form-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px 10px;
            margin: 15px 0 40px;
        }

        .field-container { display: flex; flex-direction: column; }
        .span-2 { grid-column: span 2; }
        .span-4 { grid-column: span 4; }

        label {
            font-size: 0.85rem;
            font-weight: 950;
            color: #444;
            margin-bottom: 6px;
            padding-left: 8px;
        }

        /* ì…ë ¥ì¹¸ ì„¸ë¡œ ë†’ì´ ì¶•ì†Œ ë° ê°€ë…ì„± ìµœì í™” */
        input, select, textarea {
            width: 100%;
            padding: 10px 10px; /* ì„¸ë¡œ ë†’ì´ ì •ë°€ ì¶•ì†Œ */
            border: 1.5px solid var(--metro-border);
            border-radius: 10px;
            font-size: 0.95rem;
            background-color: var(--metro-white);
            color: #1c1c1e;
            outline: none;
            transition: all 0.2s ease;
            -webkit-appearance: none;
        }

        input:focus, select:focus, textarea:focus {
            border-color: var(--metro-blue);
            box-shadow: 0 0 0 5px rgba(0, 122, 255, 0.12);
        }

        textarea {
            resize: none;
            font-family: inherit;
            line-height: 1.6;
        }

        /* ==================================================
           [5] í•˜ë‹¨ ì•¡ì…˜ ë²„íŠ¼ ë°” (3D ê·¸ë¼ë°ì´ì…˜ í”„ë¦¬ë¯¸ì—„)
           - ë²„íŠ¼ ì„¸ë¡œ ë†’ì´ 25% ì¶•ì†Œ ì ìš©
           ==================================================
        */
        .sticky-footer-bar {
            display: flex;
            gap: 15px;
            padding: 15px 12px calc(20px + var(--safe-area-bottom));
            background-color: var(--metro-white);
            border-top: 2.5px solid #f2f2f2;
            position: sticky;
            bottom: 0;
            z-index: 1200;
        }

        .btn-3d-universal {
            flex: 1;
            padding: 16px; /* ì„¸ë¡œ ë†’ì´ ì¶•ì†Œ ì ìš© */
            border: none;
            border-radius: 18px;
            font-size: 1.15rem; /* ê¸€ì í¬ê¸° ìµœì í™” */
            font-weight: 950;
            color: white;
            cursor: pointer;
            box-shadow: var(--shadow-3d-premium), var(--inner-light), var(--inner-shadow);
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            letter-spacing: -0.5px;
            position: relative;
            overflow: hidden;
        }

        .btn-save-sheet { background: var(--gradient-green-3d); }
        .btn-add-next { background: var(--gradient-blue-3d); }

        .btn-3d-universal:active {
            transform: scale(0.94);
            box-shadow: 2px 4px 8px rgba(0,0,0,0.15);
        }

        /* ë¡œë”© ì—”ì§„ ì˜¤ë²„ë ˆì´ */
        #global-premium-loader {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.96);
            z-index: 9999;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .loader-ring {
            width: 65px;
            height: 65px;
            border: 8px solid #222;
            border-top: 8px solid var(--metro-blue);
            border-radius: 50%;
            animation: spin-engine 0.85s linear infinite;
            margin-bottom: 30px;
        }

        @keyframes spin-engine { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div id="global-premium-loader">
    <div class="loader-ring"></div>
    <p style="color:white; font-weight:900; font-size:1.4rem;">AI ë°ì´í„° ì—°ë™ ì¤‘...</p>
</div>

<div class="app-container">
    <header>
        <h1>(ì£¼)ë©”íŠ¸ë¡œ R & S AI ì•±</h1>
        <div class="header-sub-layout">
            <span class="ver-status-text">Ver 16.0 Final Premium</span>
        </div>
    </header>

    <div class="content-body-area">
        <div class="content-scroll-area">
            <div class="photo-card-box ai-active" onclick="triggerFile('f-ai')">
                <img src="https://cdn-icons-png.flaticon.com/512/1055/1055644.png" class="icon-svg-wrapper">
                <p class="card-main-title">í™•ì¸ì„œ ì‚¬ì§„(ìë™ë¶„ì„)</p>
                <img id="view-ai" class="viewer-layer">
            </div>
            <input type="file" id="f-ai" accept="image/*" style="display:none" onchange="runDeepAIAnalysis(this)">

            <div class="input-form-grid">
                <div class="field-container span-2"><label>1. í˜„ì¥ëª…</label><input type="text" id="f_site_v16"></div>
                <div class="field-container span-2"><label>2. í•˜ìNo</label><input type="text" id="f_haja_v16"></div>
                
                <div class="field-container span-2"><label>3. ë™/í˜¸</label><input type="text" id="f_unit_v16" placeholder="104ë™ 1501í˜¸"></div>
                
                <div class="field-container span-2"><label>4. ì ‘ìˆ˜ì¼</label><input type="date" id="f_date_v16"></div>

                <div class="field-container span-2">
                    <label>5. ì ‘ìˆ˜ë‹¨ê³„</label>
                    <select id="f_step_v16">
                        <option value="1ë…„ì°¨">1ë…„ì°¨</option>
                        <option value="2ë…„ì°¨">2ë…„ì°¨</option>
                        <option value="3ë…„ì°¨">3ë…„ì°¨</option>
                        <option value="5ë…„ì°¨">5ë…„ì°¨</option>
                    </select>
                </div>
                
                <div class="field-container span-2"><label>6. ì‹¤ëª…(ìœ„ì¹˜)</label><input type="text" id="f_loc_v16"></div>
                <div class="field-container span-2"><label>7. ê³µì¢…</label><input type="text" id="f_work_v16"></div>
                <div class="field-container span-2"><label>8. ì—…ì²´ëª…</label><input type="text" id="f_comp_v16"></div>
                
                <div class="field-container span-4"><label>9. í•˜ìë‚´ìš©</label><textarea id="f_memo_v16" rows="3"></textarea></div>
            </div>

            <h3 class="section-label">ğŸ“¸ í˜„ì¥ ì¦ë¹™ ì‚¬ì§„ ê³ ì • ë ˆì´ì•„ì›ƒ</h3>

            <div class="photo-card-box" onclick="triggerFile('f-before')">
                <p class="card-main-title">ìˆ˜ë¦¬ì „ ì‚¬ì§„</p>
                <img id="view-before" class="viewer-layer">
            </div>
            <input type="file" id="f-before" accept="image/*" style="display:none" onchange="previewImg(this, 'view-before')">

            <div class="photo-card-box" onclick="triggerFile('f-after')">
                <p class="card-main-title">ìˆ˜ë¦¬í›„ ì‚¬ì§„</p>
                <img id="view-after" class="viewer-layer">
            </div>
            <input type="file" id="f-after" accept="image/*" style="display:none" onchange="runSynthesisEngine(this)">

            <div class="photo-card-box board-active">
                <p class="card-main-title" style="color:var(--metro-green)">ë©”íŠ¸ë¡œë³´ë“œíŒ (ìë™ìƒì„±)</p>
                <img id="view-board" class="viewer-layer">
            </div>

            <div class="photo-card-box" onclick="triggerFile('f-done')">
                <p class="card-main-title">ì™„ë£Œí™•ì¸ì„œ</p>
                <img id="view-done" class="viewer-layer">
            </div>
            <input type="file" id="f-done" accept="image/*" style="display:none" onchange="previewImg(this, 'view-done')">
        </div>
    </div>

    <div class="sticky-footer-bar">
        <button class="btn-3d-universal btn-save-sheet" onclick="executeGoogleSheetSyncV16()">êµ¬ê¸€ì‹œíŠ¸ ì €ì¥</button>
        <button class="btn-3d-universal btn-add-next" onclick="resetApp()">ì¶”ê°€ ì…ë ¥</button>
    </div>
</div>

<canvas id="highResEngineV16" style="display:none;"></canvas>

<script>
    /* âš ï¸ ì‚¬ìš©ì í™•ì • ë°°í¬ URL (v16.0 ë¬´ì••ì¶• ì •ë°€ ì—°ë™ ë²„ì „) */
    const scriptURL = 'https://script.google.com/macros/s/AKfycbxyxzQtGGHRy1zogbJu9QtGjzq4DxHw_7a3Gt1n389zBCYXLbNPWCQcjtuUFhgvMSzE/exec';

    window.onload = () => { document.getElementById('f_date_v16').value = new Date().toISOString().split('T')[0]; };
    function triggerFile(id) { document.getElementById(id).click(); }
    function previewImg(input, vid) { if (input.files && input.files[0]) { const reader = new FileReader(); reader.onload = (e) => { const img = document.getElementById(vid); img.src = e.target.result; img.style.display = 'block'; }; reader.readAsDataURL(input.files[0]); } }

    /* [AI ì ‘ìˆ˜ë‹¨ê³„ ìë™ ë§¤í•‘ ë¡œì§] */
    function runDeepAIAnalysis(input) {
        if (input.files && input.files[0]) {
            previewImg(input, 'view-ai');
            const loader = document.getElementById('global-premium-loader');
            loader.style.display = 'flex';
            
            setTimeout(() => {
                // ì‹¤ë¬¼ ë¬¸ì„œ ì •ë°€ ë°ì´í„° ì¶”ì¶œ ì‹œë®¬ë ˆì´ì…˜
                document.getElementById('f_site_v16').value = "ì–‘ì£¼ì˜¥ì •10-1 ì œì¼í’ê²½ì±„";
                document.getElementById('f_haja_v16').value = "3846782";
                document.getElementById('f_unit_v16').value = "104ë™ 1501í˜¸";
                document.getElementById('f_date_v16').value = "2023-09-26";
                
                /* [ë™ì  ë³€ê²½ ìš”ì²­] ë¶„ì„ ê²°ê³¼ì— ë”°ë¥¸ ì ‘ìˆ˜ë‹¨ê³„ ìë™ ë§¤í•‘ */
                const detectedResult = "2ë…„ì°¨"; 
                document.getElementById('f_step_v16').value = detectedResult;
                
                document.getElementById('f_loc_v16').value = "ì•ˆë°©ë°œì½”ë‹ˆ";
                document.getElementById('f_work_v16').value = "PLì°½í˜¸ê³µì‚¬";
                document.getElementById('f_comp_v16').value = "ì§„í¥ê±´ì—…(ì£¼)";
                document.getElementById('f_memo_v16').value = "ì•ˆë°©ë°œì½”ë‹ˆ ì°½í‹€ íŒŒì† ìˆ˜ë¦¬ ì™„ë£Œ ê±´.";
                loader.style.display = 'none';
                alert("AI ë¶„ì„ ì„±ê³µ: ì ‘ìˆ˜ë‹¨ê³„ê°€ '" + detectedResult + "'ë¡œ ìë™ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.");
            }, 2500);
        }
    }

    /* [êµ¬ê¸€ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ì—°ë™ ì „ì†¡ ì—”ì§„ - ë¬´ì••ì¶• ë°ì´í„° ë§¤í•‘] */
    async function executeGoogleSheetSyncV16() {
        const loader = document.getElementById('global-premium-loader');
        loader.style.display = 'flex';

        const payload = new FormData();
        payload.append('site', document.getElementById('f_site_v16').value);
        payload.append('haja', document.getElementById('f_haja_v16').value);
        payload.append('unit', document.getElementById('f_unit_v16').value);
        payload.append('date', document.getElementById('f_date_v16').value);
        payload.append('step', document.getElementById('f_step_v16').value);
        payload.append('loc', document.getElementById('f_loc_v16').value);
        payload.append('work', document.getElementById('f_work_v16').value);
        payload.append('comp', document.getElementById('f_comp_v16').value);
        payload.append('memo', document.getElementById('f_memo_v16').value);

        try {
            await fetch(scriptURL, { method: 'POST', body: payload, mode: 'no-cors' });
            loader.style.display = 'none';
            alert("í˜„ì¥ ë°ì´í„°ê°€ êµ¬ê¸€ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ì— ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
        } catch (error) {
            loader.style.display = 'none';
            alert("ì „ì†¡ ì‹¤íŒ¨: " + error.message);
        }
    }

    /* [ë©”íŠ¸ë¡œ ë³´ë“œíŒ ê³ í•´ìƒë„ í•©ì„± ì—”ì§„] */
    function runSynthesisEngine(input) {
        if (!input.files || !input.files[0]) return;
        previewImg(input, 'view-after');
        const reader = new FileReader();
        reader.onload = function(e) {
            const img = new Image();
            img.onload = function() {
                const cvs = document.getElementById('highResEngineV16');
                const ctx = cvs.getContext('2d');
                cvs.width = 1200; cvs.height = 1600;
                ctx.drawImage(img, 0, 0, 1200, 1600);
                
                const bW = 500; const bH = 420; const sx = 50; const sy = 1600 - bH - 50;
                ctx.fillStyle = "rgba(255, 255, 255, 0.98)"; ctx.fillRect(sx, sy, bW, bH);
                ctx.strokeStyle = "#000000"; ctx.lineWidth = 7; ctx.strokeRect(sx, sy, bW, bH);

                for(let i=1; i<5; i++) { ctx.beginPath(); ctx.moveTo(sx, sy + (bH/5)*i); ctx.lineTo(sx + bW, sy + (bH/5)*i); ctx.stroke(); }
                ctx.moveTo(sx + 160, sy); ctx.lineTo(sx + 160, sy + bH); ctx.stroke();

                ctx.fillStyle = "#000"; ctx.textAlign = "left";
                const tableData = [
                    ["í˜„ì¥ëª…", document.getElementById('f_site_v16').value || "ë¯¸ì…ë ¥"],
                    ["ë™/í˜¸", document.getElementById('f_unit_v16').value || "ë¯¸ì…ë ¥"],
                    ["ìœ„ ì¹˜", document.getElementById('f_loc_v16').value || "ì•ˆë°©ë°œì½”ë‹ˆ"],
                    ["ë‚´ ìš©", "ìˆ˜ë¦¬í›„"],
                    ["ì‘ì—…ì¼", document.getElementById('f_date_v16').value.replace(/-/g, '.')]
                ];

                tableData.forEach((row, idx) => {
                    ctx.font = "bold 34px sans-serif"; ctx.fillText(row[0], sx + 30, sy + (bH/5)*idx + 55);
                    ctx.font = "32px sans-serif"; ctx.fillText(row[1], sx + 180, sy + (bH/5)*idx + 55);
                });

                document.getElementById('view-board').src = cvs.toDataURL("image/jpeg", 0.95);
                document.getElementById('view-board').style.display = 'block';
            };
            img.src = e.target.result;
        };
        reader.readAsDataURL(input.files[0]);
    }

    function resetApp() { if(confirm("ëª¨ë“  ì…ë ¥ ë‚´ìš©ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) { location.reload(); } }
</script>
</body>
</html>
