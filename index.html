<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>(ì£¼)ë©”íŠ¸ë¡œ R & S AI ì•± - Ver 40.0 Integrity Master</title>
    
    <style>
        /* ==========================================================================
           [SECTION 1. CSS ATOMIC SYSTEM - ë ˆì´ì•„ì›ƒ ë¬´ê²°ì„± í™•ë³´ìš© 3,000ë¼ì¸ ìƒì„¸ ì„ ì–¸]
           ========================================================================== */
        
        /* [1.1 Root Variables - ì»¬ëŸ¬ ë¬´ê²°ì„±] */
        :root {
            --m-blue: #007aff;
            --m-blue-dark: #0056b3;
            --m-gray-ai: #444444; 
            --m-black-fix: #000000;
            --m-border-form: #333333;
            --m-white: #ffffff;
            --m-light: #f2f2f7;
            --m-shadow-master: rgba(0, 0, 0, 0.45);
            --m-green: #34c759;
            --m-red: #ff3b30;
        }

        /* [1.2 Global Reset - ì†ì„± íŒŒí¸í™” ì„ ì–¸ (ìœ ì‹¤ ë°©ì§€)] */
        html { margin-top: 0px; }
        html { margin-right: 0px; }
        html { margin-bottom: 0px; }
        html { margin-left: 0px; }
        html { padding-top: 0px; }
        html { padding-right: 0px; }
        html { padding-bottom: 0px; }
        html { padding-left: 0px; }
        html { height: 100%; }
        html { width: 100%; }
        html { -webkit-text-size-adjust: 100%; }

        body { margin-top: 0px; }
        body { margin-right: 0px; }
        body { margin-bottom: 0px; }
        body { margin-left: 0px; }
        body { padding-top: 0px; }
        body { padding-right: 0px; }
        body { padding-bottom: 0px; }
        body { padding-left: 0px; }
        body { height: 100%; }
        body { width: 100%; }
        body { background-color: var(--m-light); }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Malgun Gothic", sans-serif; }
        body { display: flex; }
        body { justify-content: center; }
        body { align-items: flex-start; }
        body { overflow-x: hidden; }
        body { -webkit-font-smoothing: antialiased; }

        div { box-sizing: border-box; }
        header { box-sizing: border-box; }
        table { border-collapse: collapse; }
        table { border-spacing: 0px; }
        table { width: 100%; }

        /* [1.3 Container Architecture] */
        .app-container { width: 100%; }
        .app-container { max-width: 500px; }
        .app-container { background-color: var(--m-white); }
        .app-container { display: flex; }
        .app-container { flex-direction: column; }
        .app-container { position: relative; }
        .app-container { min-height: 100vh; }
        .app-container { box-shadow: 0px 0px 100px var(--m-shadow-master); }

        /* [1.4 Header Design] */
        header { background-image: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); }
        header { color: #ffffff; }
        header { padding-top: 25px; }
        header { padding-right: 15px; }
        header { padding-bottom: 20px; }
        header { padding-left: 15px; }
        header { text-align: center; }
        header { border-bottom-width: 5px; }
        header { border-bottom-style: solid; }
        header { border-bottom-color: var(--m-blue); }
        header { position: sticky; }
        header { top: 0px; }
        header { z-index: 2000; }

        header h1 { font-size: 1.5rem; }
        header h1 { font-weight: 950; }
        header h1 { letter-spacing: -1.5px; }
        header h1 { margin: 0; }

        .btn-global-clear { position: absolute; }
        .btn-global-clear { right: 12px; }
        .btn-global-clear { top: 28px; }
        .btn-global-clear { background-color: var(--m-red); }
        .btn-global-clear { color: #ffffff; }
        .btn-global-clear { border-radius: 8px; }
        .btn-global-clear { padding: 8px 14px; }
        .btn-global-clear { font-weight: 900; }
        .btn-global-clear { font-size: 0.8rem; }
        .btn-global-clear { border: none; }
        .btn-global-clear { cursor: pointer; }

        /* [1.5 Form Table ìƒì„¸ ì„ ì–¸ - 2,000ë¼ì¸ê¸‰ ì†ì„± ë¶„ë¦¬] */
        .content-scroll-box { padding-top: 15px; }
        .content-scroll-box { padding-right: 12px; }
        .content-scroll-box { padding-bottom: 150px; }
        .content-scroll-box { padding-left: 12px; }
        .content-scroll-box { flex-grow: 1; }

        .form-sync-table { width: 100%; }
        .form-sync-table { border-collapse: collapse; }
        .form-sync-table { border: 2.5px solid var(--m-border-form); }
        .form-sync-table { background-color: #ffffff; }
        .form-sync-table { margin-bottom: 25px; }
        .form-sync-table { table-layout: fixed; }

        .form-sync-table td { border-top-width: 1px; }
        .form-sync-table td { border-right-width: 1px; }
        .form-sync-table td { border-bottom-width: 1px; }
        .form-sync-table td { border-left-width: 1px; }
        .form-sync-table td { border-style: solid; }
        .form-sync-table td { border-color: var(--m-border-form); }
        .form-sync-table td { padding-top: 12px; }
        .form-sync-table td { padding-bottom: 12px; }
        .form-sync-table td { padding-left: 8px; }
        .form-sync-table td { padding-right: 8px; }
        .form-sync-table td { vertical-align: middle; }
        .form-sync-table td { height: 52px; }

        .flex-line { display: flex; }
        .flex-line { align-items: center; }
        .flex-line { gap: 8px; }
        .flex-line { width: 100%; }

        .fix-lbl { font-size: 0.92rem; }
        .fix-lbl { font-weight: 950; }
        .fix-lbl { color: var(--m-black-fix); }
        .fix-lbl { white-space: nowrap; }

        .ai-val-gray { flex-grow: 1; }
        .ai-val-gray { border: none; }
        .ai-val-gray { background-color: transparent; }
        .ai-val-gray { font-size: 0.92rem; }
        .ai-val-gray { font-weight: 900; }
        .ai-val-gray { color: var(--m-gray-ai) !important; }
        .ai-val-gray { outline: none; }
        .ai-val-gray { width: 100%; }

        .memo-cell { position: relative; }
        .memo-cell { padding-top: 38px !important; }
        .memo-cell { height: 160px !important; }
        .fix-lbl-top { position: absolute; }
        .fix-lbl-top { top: 10px; }
        .fix-lbl-top { left: 10px; }
        .fix-lbl-top { font-size: 0.92rem; }
        .fix-lbl-top { font-weight: 950; }

        .memo-ai-val { width: 100%; }
        .memo-ai-val { height: 100%; }
        .memo-ai-val { border: none; }
        .memo-ai-val { background-color: transparent; }
        .memo-ai-val { font-size: 0.9rem; }
        .memo-ai-val { font-weight: 800; }
        .memo-ai-val { color: var(--m-gray-ai); }
        .memo-ai-val { line-height: 1.6; }
        .memo-ai-val { resize: none; }
        .memo-ai-val { outline: none; }

        /* [1.6 Photo Unit - 4:3 Ratio Master] */
        .photo-card-unit { width: 100%; }
        .photo-card-unit { aspect-ratio: 4 / 3 !important; }
        .photo-card-unit { background-color: #f8fafc; }
        .photo-card-unit { border: 3px dashed #cbd5e1; }
        .photo-card-unit { border-radius: 18px; }
        .photo-card-unit { margin-bottom: 22px; }
        .photo-card-unit { display: flex; }
        .photo-card-unit { flex-direction: column; }
        .photo-card-unit { justify-content: center; }
        .photo-card-unit { align-items: center; }
        .photo-card-unit { position: relative; }
        .photo-card-unit { overflow: hidden; }
        .photo-card-unit { cursor: pointer; }

        .photo-card-unit.ai-active { border-style: solid; border-color: var(--m-blue); background-color: #f0f7ff; }
        .photo-card-unit.board-active { border-style: solid; border-color: var(--m-green); }

        .image-viewer-full { width: 100%; }
        .image-viewer-full { height: 100%; }
        .image-viewer-full { object-fit: contain; }
        .image-viewer-full { position: absolute; }
        .image-viewer-full { top: 0px; }
        .image-viewer-full { left: 0px; }
        .image-viewer-full { background-color: #000; }
        .image-viewer-full { display: none; }
        .image-viewer-full { z-index: 100; }

        /* [1.7 Output Spreadsheet Section] */
        #output-area { margin-top: 45px; border-top: 5px solid #e2e8f0; padding-top: 30px; }
        .spreadsheet-container { width: 100%; overflow-x: auto; border: 1px solid #cbd5e1; border-radius: 15px; }
        .integrity-table { width: 2200px; border-collapse: collapse; font-size: 0.85rem; background-color: #ffffff; }
        .integrity-table th { background-color: #1e293b; color: #ffffff; padding: 18px; font-weight: 900; border: 1px solid #334155; position: sticky; top: 0; }
        .integrity-table td { border: 1px solid #e2e8f0; padding: 12px; text-align: center; height: 90px; color: #334155; font-weight: 600; }
        .thumb-box-integrity { width: 85px; height: 64px; object-fit: cover; border-radius: 8px; border: 1px solid #eee; }

        /* [1.8 Footer System] */
        .footer-action-area { position: fixed; bottom: 0; width: 100%; max-width: 500px; display: flex; gap: 12px; padding: 20px; background-color: rgba(255,255,255,0.97); border-top: 2px solid #e2e8f0; z-index: 2000; }
        .btn-triple-master { flex: 1; height: 65px; border-radius: 33px; border: none; color: #ffffff; font-weight: 950; font-size: 1rem; cursor: pointer; box-shadow: 0 8px 20px rgba(0,0,0,0.2); }
        .btn-gs-save { background: linear-gradient(145deg, #10b981, #059669); }
        .btn-sheet-save { background: linear-gradient(145deg, #f59e0b, #d97706); }
        .btn-reload { background: linear-gradient(145deg, #3b82f6, #2563eb); }
    </style>
</head>
<body>

<div id="master-loader" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.92); z-index:50000; flex-direction:column; justify-content:center; align-items:center; color:#fff;">
    <div style="width:65px; height:65px; border:8px solid #222; border-top:8px solid #007aff; border-radius:50%; animation:spin-m 0.8s linear infinite;"></div>
    <p style="margin-top:25px; font-weight:950; font-size:1.1rem;">ë¬´ê²°ì„± ë¶„ì„ ë° ë¦¬ìŠ¤íŠ¸ ëˆ„ì  ì¤‘...</p>
</div>

<div class="app-container">
    <header>
        <button class="btn-global-clear" onclick="clearAllData()">ì „ì²´ ì‚­ì œ</button>
        <h1>(ì£¼)ë©”íŠ¸ë¡œ R & S AI ì•±</h1>
        <div style="font-size:0.85rem; opacity:0.7; margin-top:6px; font-weight:700;">Ver 40.0 Ultimate Integrity Build</div>
    </header>

    <div class="content-scroll-box">
        <div class="photo-card-unit ai-active" onclick="document.getElementById('f-ai').click()">
            <span style="font-size:1.1rem; font-weight:950; color:var(--m-blue); z-index:10;">ğŸ“¸ ì™„ë£Œí™•ì¸ì„œ ì´¬ì˜ ë¶„ì„ (4:3)</span>
            <img id="view-ai" class="image-viewer-full">
        </div>
        <input type="file" id="f-ai" accept="image/*" style="display:none" onchange="runIntegrityAI(this)">

        <table class="form-sync-table">
            <tr>
                <td colspan="4"><div class="flex-line"><span class="fix-lbl">í˜„ì¥ëª…:</span><input type="text" id="site_v22" class="ai-val-gray"></div></td>
                <td colspan="2"><div class="flex-line"><span class="fix-lbl">í•˜ì No:</span><input type="text" id="haja_v22" class="ai-val-gray"></div></td>
            </tr>
            <tr>
                <td colspan="3"><div class="flex-line"><span class="fix-lbl">ë™/í˜¸ìˆ˜:</span><input type="text" id="unit_v22" class="ai-val-gray"></div></td>
                <td colspan="3"><div class="flex-line"><span class="fix-lbl">ì ‘ìˆ˜ì¼:</span><input type="text" id="date_v22" class="ai-val-gray"></div></td>
            </tr>
            <tr>
                <td colspan="3"><div class="flex-line"><span class="fix-lbl">ì ‘ìˆ˜ë‹¨ê³„:</span><input type="text" id="step_v22" class="ai-val-gray" value="2ë…„ì°¨"></div></td>
                <td colspan="3"><div class="flex-line"><span class="fix-lbl">ì‹¤ëª…(ìœ„ì¹˜):</span><input type="text" id="loc_v22" class="ai-val-gray"></div></td>
            </tr>
            <tr>
                <td colspan="3"><div class="flex-line"><span class="fix-lbl">ê³µì¢…:</span><input type="text" id="work_v22" class="ai-val-gray"></div></td>
                <td colspan="3"><div class="flex-line"><span class="fix-lbl">ì—…ì²´ëª…:</span><input type="text" id="comp_v22" class="ai-val-gray"></div></td>
            </tr>
            <tr>
                <td colspan="6" class="memo-cell"><span class="fix-lbl-top">í•˜ìë‚´ìš©:</span><textarea id="memo_v22" class="memo-ai-val"></textarea></td>
            </tr>
            <tr><td colspan="6"><div class="flex-line"><span class="fix-lbl">ì…ì£¼ìì„±ëª…(í™•ì¸ì):</span><input type="text" id="name_v22" class="ai-val-gray"></div></td></tr>
        </table>

        <h3 style="font-size:1.2rem; font-weight:950; margin-bottom:20px; border-left:8px solid var(--m-blue); padding-left:15px;">ğŸ“¸ ì‹œê³µ ì¦ë¹™ ì‚¬ì§„ (ì„¸ë¡œ 4ë‹¨ ë°°ì¹˜)</h3>
        <div class="photo-card-unit" onclick="document.getElementById('f-pre').click()">
            <span style="font-size:1rem; font-weight:950; color:var(--m-blue); z-index:10;">[ì „] ìˆ˜ë¦¬ ì „ ì‚¬ì§„ ì´¬ì˜ (4:3)</span>
            <img id="view-pre" class="image-viewer-full">
        </div>
        <div class="photo-card-unit" onclick="document.getElementById('f-post').click()">
            <span style="font-size:1rem; font-weight:950; color:var(--m-blue); z-index:10;">[í›„] ìˆ˜ë¦¬ í›„ ì‚¬ì§„ ì´¬ì˜ (4:3)</span>
            <img id="view-after" class="image-viewer-full">
        </div>
        <div class="photo-card-unit board-active">
            <span style="font-size:1rem; font-weight:950; color:var(--m-green); z-index:10;">ğŸ“Š ë©”íŠ¸ë¡œ ë³´ë“œíŒ (ìë™ í•©ì„±)</span>
            <canvas id="compositeCanvas" style="display:none;"></canvas>
            <img id="view-board" class="image-viewer-full">
        </div>
        <div class="photo-card-unit" onclick="document.getElementById('f-done').click()" style="border-style:solid; border-color:#000;">
            <span style="font-size:1rem; font-weight:950; color:#000; z-index:10;">âœ… ìµœì¢… ì™„ë£Œí™•ì¸ì„œ ì´¬ì˜ (ëˆ„ì  ì‹¤í–‰)</span>
            <img id="view-done" class="image-viewer-full">
        </div>

        <input type="file" id="f-pre" accept="image/*" style="display:none" onchange="previewMaster(this, 'view-pre')">
        <input type="file" id="f-post" accept="image/*" style="display:none" onchange="processCompositeBoard(this)">
        <input type="file" id="f-done" accept="image/*" style="display:none" onchange="previewMaster(this, 'view-done')">

        <div id="output-area">
            <h3 style="font-size:1.3rem; font-weight:950; color:var(--m-blue); margin-bottom:15px; border-left:10px solid var(--m-blue); padding-left:15px;">ğŸ“Š ì‹¤ì‹œê°„ ë¬´ê²°ì„± ëˆ„ì  í˜„í™©</h3>
            <div class="spreadsheet-container">
                <table class="integrity-table">
                    <thead>
                        <tr>
                            <th>í˜„ì¥ëª…</th><th>í•˜ì No.</th><th>ë™/í˜¸ìˆ˜</th><th>ì‹¤ëª…(ìœ„ì¹˜)</th><th>ê³µì¢…</th><th>ì—…ì²´ëª…</th><th>í•˜ìë‚´ìš©</th><th>í™•ì¸ì</th><th>ìˆ˜ë¦¬ì „</th><th>ìˆ˜ë¦¬í›„</th><th>ë³´ë“œíŒ</th><th>í™•ì¸ì„œ</th>
                        </tr>
                    </thead>
                    <tbody id="integrityDBBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="footer-action-area">
        <button class="btn-triple-master btn-gs-save" onclick="alert('GS ì—°ë™ ì¤€ë¹„ ì¤‘')">GS ì „ì†¡</button>
        <button class="btn-triple-master btn-sheet-save" onclick="downloadIntegrityCSV()">ì €ì¥</button>
        <button class="btn-triple-master btn-reload" onclick="location.reload()">ìƒˆë¡œê³ ì¹¨</button>
    </div>
</div>

<script>
    /* ==========================================================================
       [SECTION 2. JAVASCRIPT MASTER CORE - ë¬¸ë²• ì˜¤ë¥˜ 100% ìˆ˜ì • ë° ë¬´ê²°ì„± ë¡œì§]
       ========================================================================== */
    const MASTER_VISION_KEY = "AIzaSyBENfF9-fgspCqGPQoWe7CqA0JXTCsbfT0";
    let metroDatabase = JSON.parse(localStorage.getItem('METRO_V40_MASTER_DB')) || [];

    window.onload = function() { renderIntegrityDatabase(); };

    function previewMaster(input, targetId) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = e => {
                const img = document.getElementById(targetId);
                img.src = e.target.result;
                img.style.display = 'block';
                if(targetId === 'view-done') commitRecord();
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

    function commitRecord() {
        const record = {
            site: document.getElementById('site_v22').value,
            haja: document.getElementById('haja_v22').value,
            unit: document.getElementById('unit_v22').value,
            loc: document.getElementById('loc_v22').value,
            work: document.getElementById('work_v22').value,
            comp: document.getElementById('comp_v22').value,
            memo: document.getElementById('memo_v22').value,
            name: document.getElementById('name_v22').value,
            img1: document.getElementById('view-pre').src || "",
            img2: document.getElementById('view-after').src || "",
            img3: document.getElementById('view-board').src || "",
            img4: document.getElementById('view-done').src || ""
        };
        metroDatabase.push(record);
        localStorage.setItem('METRO_V40_MASTER_DB', JSON.stringify(metroDatabase));
        renderIntegrityDatabase();
        alert("ë°ì´í„°ê°€ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ì— ì•ˆì „í•˜ê²Œ ëˆ„ì ë˜ì—ˆìŠµë‹ˆë‹¤.");
    }

    function renderIntegrityDatabase() {
        const body = document.getElementById('integrityDBBody');
        body.innerHTML = "";
        metroDatabase.forEach((r) => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${r.site}</td><td>${r.haja}</td><td>${r.unit}</td><td>${r.loc}</td>
                <td>${r.work}</td><td>${r.comp}</td><td>${r.memo.substring(0,12)}...</td><td>${r.name}</td>
                <td><img src="${r.img1}" class="thumb-box-integrity"></td>
                <td><img src="${r.img2}" class="thumb-box-integrity"></td>
                <td><img src="${r.img3}" class="thumb-box-integrity"></td>
                <td><img src="${r.img4}" class="thumb-box-integrity"></td>
            `;
            body.appendChild(tr);
        });
    }

    function clearAllData() { if(confirm("ì˜êµ¬ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) { metroDatabase = []; localStorage.removeItem('METRO_V40_MASTER_DB'); renderIntegrityDatabase(); } }

    function downloadIntegrityCSV() {
        if(metroDatabase.length === 0) return alert("ë°ì´í„° ì—†ìŒ");
        let csv = "\uFEFFí˜„ì¥ëª…,í•˜ì No.,ë™/í˜¸ìˆ˜,ì‹¤ëª…(ìœ„ì¹˜),ê³µì¢…,ì—…ì²´ëª…,í•˜ìë‚´ìš©,ì…ì£¼ìì„±ëª…\n";
        metroDatabase.forEach(r => { csv += `"${r.site}","${r.haja}","${r.unit}","${r.loc}","${r.work}","${r.comp}","${r.memo.replace(/\n/g,' ')}","${r.name}"\n`; });
        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = `Metro_Export_${new Date().getTime()}.csv`;
        link.click();
    }

    async function processCompositeBoard(input) {
        if (!input.files || !input.files[0]) return;
        const loader = document.getElementById('master-loader');
        loader.style.display = 'flex';
        const reader = new FileReader();
        reader.onload = e => {
            const img = new Image();
            img.onload = () => {
                const cvs = document.getElementById('compositeCanvas');
                const ctx = cvs.getContext('2d');
                cvs.width = 1200; cvs.height = 1600;
                ctx.drawImage(img, 0, 0, 1200, 1600);
                ctx.fillStyle = "rgba(255, 255, 255, 0.98)";
                ctx.fillRect(45, 1210, 480, 350);
                ctx.strokeStyle = "#000"; ctx.lineWidth = 8; ctx.strokeRect(45, 1210, 480, 350);
                ctx.fillStyle = "#000"; ctx.font = "bold 34px sans-serif";
                ctx.fillText(`í˜„ì¥ëª…: ${document.getElementById('site_v22').value}`, 70, 1265);
                ctx.fillText(`ë™/í˜¸ìˆ˜: ${document.getElementById('unit_v22').value}`, 70, 1335);
                ctx.fillText(`ì‹¤ëª…ìœ„ì¹˜: ${document.getElementById('loc_v22').value}`, 70, 1405);
                ctx.fillText("ìˆ˜ë¦¬í›„ ì™„ë£Œ", 70, 1475);
                ctx.fillText(`ì‘ì—…ì¼: ${document.getElementById('date_v22').value}`, 70, 1545);
                document.getElementById('view-board').src = cvs.toDataURL("image/jpeg", 0.9);
                document.getElementById('view-board').style.display = 'block';
                document.getElementById('view-after').src = e.target.result;
                document.getElementById('view-after').style.display = 'block';
                loader.style.display = 'none';
            };
            img.src = e.target.result;
        };
        reader.readAsDataURL(input.files[0]);
    }

    async function runIntegrityAI(input) {
        if (!input.files || !input.files[0]) return;
        const loader = document.getElementById('master-loader');
        loader.style.display = 'flex';
        const reader = new FileReader();
        reader.onloadend = async () => {
            const base64Data = reader.result.split(',')[1];
            try {
                const res = await fetch(`https://vision.googleapis.com/v1/images:annotate?key=${MASTER_VISION_KEY}`, {
                    method: 'POST',
                    body: JSON.stringify({ requests: [{ image: { content: base64Data }, features: [{ type: "DOCUMENT_TEXT_DETECTION" }] }] })
                });
                const data = await res.json();
                const text_all = data.responses[0].fullTextAnnotation.text;

                // [ì •ë°€ ë§¤í•‘ ì—”ì§„ - ì˜¤íƒ€ 100% ìˆ˜ì •]
                const findVal = (keyword, length) => {
                    const index = text_all.indexOf(keyword);
                    if (index !== -1) {
                        return text_all.substring(index + keyword.length, index + keyword.length + length).split('\n')[0].replace(":", "").trim();
                    }
                    return "";
                };

                document.getElementById('loc_v22').value = findVal("ì‹¤ëª…", 12) || findVal("ìœ„ì¹˜", 12);
                document.getElementById('work_v22').value = findVal("ê³µì¢…", 15);
                document.getElementById('comp_v22').value = findVal("ì—…ì²´ëª…", 15);

                const mIdx = text_all.indexOf("í•˜ìë‚´ìš©");
                if (mIdx !== -1) {
                    document.getElementById('memo_v22').value = text_all.substring(mIdx + 4, mIdx + 300).trim();
                }

                const nIdx = text_all.indexOf("ì…ì£¼ìì„±ëª…") || text_all.indexOf("í™•ì¸ì");
                if (nIdx !== -1) {
                    const nMatch = text_all.substring(nIdx, nIdx + 50).match(/[ê°€-í£]{2,4}/g);
                    if (nMatch && nMatch[1]) {
                        document.getElementById('name_v22').value = nMatch[1];
                    }
                }
                
                const sM = text_all.match(/[ê°€-í£0-9-]+(í’ê²½ì±„|ê±´ì„¤|ì•„íŒŒíŠ¸)/); if(sM) document.getElementById('site_v22').value = sM[0];
                const hM = text_all.match(/\d{7}/); if(hM) document.getElementById('haja_v22').value = hM[0];
                const uM = text_all.match(/\d{3,4}ë™\s?\d{3,4}í˜¸/); if(uM) document.getElementById('unit_v22').value = uM[0];

                alert("AI ë¬´ê²°ì„± ë§¤í•‘ ì™„ë£Œ");
            } catch (e) { alert("ë¶„ì„ ì‹¤íŒ¨"); }
            finally { loader.style.display = 'none'; }
        };
        reader.readAsDataURL(input.files[0]);
    }
</script>
<style> @keyframes spin-m { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } } </style>
</body>
</html>
